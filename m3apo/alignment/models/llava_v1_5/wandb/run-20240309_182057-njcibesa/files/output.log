  0%|          | 0/1464 [00:00<?, ?it/s]/mnt/petrelfs/songmingyang/code/mm/MAPO/m3apo/alignment/trainer/llava_dpo_trainer.py:145: UserWarning: compute_loss is only implemented for DPODataCollatorWithPadding, and you passed a datacollator that is different than DPODataCollatorWithPadding - you might see unexpected behavior. Alternatively, you can implement your own prediction_step method if you are using a custom data collator
  warnings.warn(
0
0
{'loss': 0.6931, 'learning_rate': 4.545454545454545e-08, 'rewards/chosen': 0.0, 'rewards/rejected': 0.0, 'rewards/accuracies': 0.0, 'rewards/margins': 0.0, 'policy_logps/rejected': -299.92828369140625, 'policy_logps/chosen': -301.01531982421875, 'referece_logps/rejected': -299.92828369140625, 'referece_logps/chosen': -301.01531982421875, 'logits/rejected': -0.37190359830856323, 'logits/chosen': -0.4063689410686493, 'epoch': 0.0}
1
Could not estimate the number of tokens of the input, floating-point operations will not be computed
  0%|          | 1/1464 [00:24<9:59:22, 24.58s/it]

  0%|          | 2/1464 [00:45<9:12:51, 22.69s/it]
{'loss': 0.6931, 'learning_rate': 9.09090909090909e-08, 'rewards/chosen': 0.0, 'rewards/rejected': 0.0, 'rewards/accuracies': 0.0, 'rewards/margins': 0.0, 'policy_logps/rejected': -433.8616638183594, 'policy_logps/chosen': -412.6845397949219, 'referece_logps/rejected': -433.8616638183594, 'referece_logps/chosen': -412.6845397949219, 'logits/rejected': 0.053385090082883835, 'logits/chosen': 0.06789463758468628, 'epoch': 0.0}
2

  0%|          | 3/1464 [01:07<9:02:58, 22.30s/it]
{'loss': 0.7034, 'learning_rate': 1.3636363636363635e-07, 'rewards/chosen': 0.009064199402928352, 'rewards/rejected': 0.007420063484460115, 'rewards/accuracies': 0.5, 'rewards/margins': 0.0016441354528069496, 'policy_logps/rejected': -414.8371276855469, 'policy_logps/chosen': -409.87615966796875, 'referece_logps/rejected': -414.91131591796875, 'referece_logps/chosen': -409.96685791015625, 'logits/rejected': 0.17330247163772583, 'logits/chosen': 0.1517719179391861, 'epoch': 0.01}
3

  0%|          | 4/1464 [01:28<8:50:05, 21.78s/it]
{'loss': 0.6945, 'learning_rate': 1.818181818181818e-07, 'rewards/chosen': 0.016381550580263138, 'rewards/rejected': 0.015201426111161709, 'rewards/accuracies': 0.625, 'rewards/margins': 0.001180124469101429, 'policy_logps/rejected': -416.7080078125, 'policy_logps/chosen': -366.7529296875, 'referece_logps/rejected': -416.8600158691406, 'referece_logps/chosen': -366.916748046875, 'logits/rejected': -0.9417762756347656, 'logits/chosen': -1.0885615348815918, 'epoch': 0.01}
4

  0%|          | 5/1464 [01:49<8:42:50, 21.50s/it]
{'loss': 0.6983, 'learning_rate': 2.2727272727272726e-07, 'rewards/chosen': -0.014494896866381168, 'rewards/rejected': 0.013561727479100227, 'rewards/accuracies': 0.375, 'rewards/margins': -0.028056621551513672, 'policy_logps/rejected': -378.8262634277344, 'policy_logps/chosen': -390.1478576660156, 'referece_logps/rejected': -378.9619140625, 'referece_logps/chosen': -390.0029296875, 'logits/rejected': 0.17857138812541962, 'logits/chosen': 0.12615695595741272, 'epoch': 0.01}
5
5
{'loss': 0.6964, 'learning_rate': 2.727272727272727e-07, 'rewards/chosen': -0.01587829552590847, 'rewards/rejected': -0.027309225872159004, 'rewards/accuracies': 0.6875, 'rewards/margins': 0.011430932208895683, 'policy_logps/rejected': -357.40460205078125, 'policy_logps/chosen': -316.0541076660156, 'referece_logps/rejected': -357.1315612792969, 'referece_logps/chosen': -315.8953552246094, 'logits/rejected': -0.7727694511413574, 'logits/chosen': -0.9226255416870117, 'epoch': 0.01}

  0%|          | 6/1464 [02:10<8:36:47, 21.27s/it]

  0%|          | 7/1464 [02:31<8:33:36, 21.15s/it]
{'loss': 0.69, 'learning_rate': 3.1818181818181815e-07, 'rewards/chosen': 0.015654422342777252, 'rewards/rejected': -0.0014342309441417456, 'rewards/accuracies': 0.625, 'rewards/margins': 0.01708865351974964, 'policy_logps/rejected': -298.10504150390625, 'policy_logps/chosen': -327.615966796875, 'referece_logps/rejected': -298.0906982421875, 'referece_logps/chosen': -327.77252197265625, 'logits/rejected': -0.22517144680023193, 'logits/chosen': -0.27088552713394165, 'epoch': 0.01}
7
7
{'loss': 0.6986, 'learning_rate': 3.636363636363636e-07, 'rewards/chosen': -0.004384804982692003, 'rewards/rejected': 0.013049649074673653, 'rewards/accuracies': 0.4375, 'rewards/margins': -0.01743445359170437, 'policy_logps/rejected': -413.64697265625, 'policy_logps/chosen': -440.78399658203125, 'referece_logps/rejected': -413.7774963378906, 'referece_logps/chosen': -440.74017333984375, 'logits/rejected': -0.501695990562439, 'logits/chosen': -0.47782063484191895, 'epoch': 0.02}

  1%|          | 8/1464 [02:52<8:33:49, 21.17s/it]

  1%|          | 9/1464 [03:13<8:32:45, 21.14s/it]
{'loss': 0.6901, 'learning_rate': 4.090909090909091e-07, 'rewards/chosen': 0.01716175116598606, 'rewards/rejected': -0.0048828125, 'rewards/accuracies': 0.625, 'rewards/margins': 0.02204456366598606, 'policy_logps/rejected': -330.2890625, 'policy_logps/chosen': -337.21148681640625, 'referece_logps/rejected': -330.240234375, 'referece_logps/chosen': -337.38311767578125, 'logits/rejected': -0.018120303750038147, 'logits/chosen': -0.007087968289852142, 'epoch': 0.02}
9
9
{'loss': 0.687, 'learning_rate': 4.545454545454545e-07, 'rewards/chosen': 0.02680955082178116, 'rewards/rejected': 0.005662443116307259, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.02114710956811905, 'policy_logps/rejected': -404.6373291015625, 'policy_logps/chosen': -410.3912353515625, 'referece_logps/rejected': -404.6939392089844, 'referece_logps/chosen': -410.65936279296875, 'logits/rejected': -1.0728811025619507, 'logits/chosen': -1.0364744663238525, 'epoch': 0.02}

  1%|          | 10/1464 [03:34<8:30:34, 21.07s/it]

  1%|          | 11/1464 [03:55<8:29:58, 21.06s/it]
{'loss': 0.7041, 'learning_rate': 5e-07, 'rewards/chosen': -0.03879252076148987, 'rewards/rejected': 0.009345818310976028, 'rewards/accuracies': 0.1875, 'rewards/margins': -0.0481383316218853, 'policy_logps/rejected': -373.51470947265625, 'policy_logps/chosen': -403.73162841796875, 'referece_logps/rejected': -373.6081237792969, 'referece_logps/chosen': -403.34368896484375, 'logits/rejected': -0.4166249632835388, 'logits/chosen': -0.4971877336502075, 'epoch': 0.02}
11

  1%|          | 12/1464 [04:16<8:28:28, 21.01s/it]
{'loss': 0.693, 'learning_rate': 5.454545454545454e-07, 'rewards/chosen': -0.001901531359180808, 'rewards/rejected': 0.0006771567277610302, 'rewards/accuracies': 0.4375, 'rewards/margins': -0.0025786873884499073, 'policy_logps/rejected': -329.6387939453125, 'policy_logps/chosen': -320.1996765136719, 'referece_logps/rejected': -329.6455383300781, 'referece_logps/chosen': -320.1806335449219, 'logits/rejected': -0.42629772424697876, 'logits/chosen': -0.5997448563575745, 'epoch': 0.02}
12

  1%|          | 13/1464 [04:37<8:24:51, 20.88s/it]
{'loss': 0.6878, 'learning_rate': 5.909090909090909e-07, 'rewards/chosen': -0.0025850776582956314, 'rewards/rejected': 0.007950210943818092, 'rewards/accuracies': 0.3125, 'rewards/margins': -0.01053528767079115, 'policy_logps/rejected': -346.8002624511719, 'policy_logps/chosen': -326.0248718261719, 'referece_logps/rejected': -346.8797607421875, 'referece_logps/chosen': -325.9990234375, 'logits/rejected': -0.18225768208503723, 'logits/chosen': -0.2359713912010193, 'epoch': 0.03}
13

  1%|          | 14/1464 [04:57<8:22:35, 20.80s/it]
{'loss': 0.6948, 'learning_rate': 6.363636363636363e-07, 'rewards/chosen': -0.01482696644961834, 'rewards/rejected': -0.014909746125340462, 'rewards/accuracies': 0.4375, 'rewards/margins': 8.277921006083488e-05, 'policy_logps/rejected': -283.1346130371094, 'policy_logps/chosen': -359.0267639160156, 'referece_logps/rejected': -282.98553466796875, 'referece_logps/chosen': -358.87847900390625, 'logits/rejected': -0.2277792990207672, 'logits/chosen': -0.24937616288661957, 'epoch': 0.03}
14

  1%|          | 15/1464 [05:18<8:24:50, 20.90s/it]
{'loss': 0.696, 'learning_rate': 6.818181818181817e-07, 'rewards/chosen': -0.0186309814453125, 'rewards/rejected': -0.011142445728182793, 'rewards/accuracies': 0.5625, 'rewards/margins': -0.007488534785807133, 'policy_logps/rejected': -421.86004638671875, 'policy_logps/chosen': -428.78509521484375, 'referece_logps/rejected': -421.7486267089844, 'referece_logps/chosen': -428.59881591796875, 'logits/rejected': -0.3347707986831665, 'logits/chosen': -0.31932032108306885, 'epoch': 0.03}
15

  1%|          | 16/1464 [05:39<8:24:56, 20.92s/it]
{'loss': 0.6912, 'learning_rate': 7.272727272727272e-07, 'rewards/chosen': -0.0031857495196163654, 'rewards/rejected': -0.021266745403409004, 'rewards/accuracies': 0.625, 'rewards/margins': 0.018080998212099075, 'policy_logps/rejected': -370.3206787109375, 'policy_logps/chosen': -430.2059326171875, 'referece_logps/rejected': -370.1080017089844, 'referece_logps/chosen': -430.1741027832031, 'logits/rejected': -0.17555277049541473, 'logits/chosen': -0.19053497910499573, 'epoch': 0.03}
16
16
{'loss': 0.696, 'learning_rate': 7.727272727272727e-07, 'rewards/chosen': -0.016352510079741478, 'rewards/rejected': 0.005932617001235485, 'rewards/accuracies': 0.375, 'rewards/margins': -0.022285129874944687, 'policy_logps/rejected': -313.8775329589844, 'policy_logps/chosen': -324.7017822265625, 'referece_logps/rejected': -313.9368591308594, 'referece_logps/chosen': -324.53826904296875, 'logits/rejected': -0.22533699870109558, 'logits/chosen': -0.2646670341491699, 'epoch': 0.03}

  1%|          | 17/1464 [06:00<8:24:58, 20.94s/it]

  1%|          | 18/1464 [06:21<8:24:30, 20.93s/it]
{'loss': 0.6974, 'learning_rate': 8.181818181818182e-07, 'rewards/chosen': -0.007463646121323109, 'rewards/rejected': 0.0009999281028285623, 'rewards/accuracies': 0.375, 'rewards/margins': -0.008463572710752487, 'policy_logps/rejected': -354.7222595214844, 'policy_logps/chosen': -458.822509765625, 'referece_logps/rejected': -354.7322692871094, 'referece_logps/chosen': -458.7479248046875, 'logits/rejected': -0.8840578198432922, 'logits/chosen': -1.0025919675827026, 'epoch': 0.04}
18

  1%|▏         | 19/1464 [06:42<8:24:11, 20.94s/it]
{'loss': 0.6851, 'learning_rate': 8.636363636363636e-07, 'rewards/chosen': 0.006626272574067116, 'rewards/rejected': -0.018759537488222122, 'rewards/accuracies': 0.6875, 'rewards/margins': 0.02538580819964409, 'policy_logps/rejected': -266.05218505859375, 'policy_logps/chosen': -289.4576721191406, 'referece_logps/rejected': -265.86456298828125, 'referece_logps/chosen': -289.5239562988281, 'logits/rejected': -0.5147222876548767, 'logits/chosen': -0.48553410172462463, 'epoch': 0.04}
19

  1%|▏         | 20/1464 [07:02<8:14:33, 20.55s/it]
{'loss': 0.692, 'learning_rate': 9.09090909090909e-07, 'rewards/chosen': -0.004040241241455078, 'rewards/rejected': 0.004296684637665749, 'rewards/accuracies': 0.5, 'rewards/margins': -0.008336926810443401, 'policy_logps/rejected': -391.5858154296875, 'policy_logps/chosen': -332.8674011230469, 'referece_logps/rejected': -391.6287841796875, 'referece_logps/chosen': -332.8270263671875, 'logits/rejected': -0.7776002287864685, 'logits/chosen': -0.663705587387085, 'epoch': 0.04}
20

  1%|▏         | 21/1464 [07:23<8:18:05, 20.71s/it]
{'loss': 0.6997, 'learning_rate': 9.545454545454546e-07, 'rewards/chosen': 0.0007966032717376947, 'rewards/rejected': -0.009987831115722656, 'rewards/accuracies': 0.625, 'rewards/margins': 0.010784435085952282, 'policy_logps/rejected': -435.3117980957031, 'policy_logps/chosen': -435.7242736816406, 'referece_logps/rejected': -435.2118835449219, 'referece_logps/chosen': -435.7322082519531, 'logits/rejected': -0.3281571865081787, 'logits/chosen': -0.277236670255661, 'epoch': 0.04}
21

  2%|▏         | 22/1464 [07:44<8:20:49, 20.84s/it]
{'loss': 0.6982, 'learning_rate': 1e-06, 'rewards/chosen': -0.022968720644712448, 'rewards/rejected': -0.005548810586333275, 'rewards/accuracies': 0.375, 'rewards/margins': -0.017419910058379173, 'policy_logps/rejected': -399.9678955078125, 'policy_logps/chosen': -344.1651611328125, 'referece_logps/rejected': -399.9123840332031, 'referece_logps/chosen': -343.93548583984375, 'logits/rejected': -0.40515756607055664, 'logits/chosen': -0.36935192346572876, 'epoch': 0.05}
22

  2%|▏         | 23/1464 [08:05<8:21:48, 20.89s/it]
{'loss': 0.6955, 'learning_rate': 1.0454545454545454e-06, 'rewards/chosen': -0.0036596297286450863, 'rewards/rejected': 0.015009785071015358, 'rewards/accuracies': 0.4375, 'rewards/margins': -0.01866941526532173, 'policy_logps/rejected': -363.54412841796875, 'policy_logps/chosen': -541.29248046875, 'referece_logps/rejected': -363.6942443847656, 'referece_logps/chosen': -541.2559204101562, 'logits/rejected': -0.5194019079208374, 'logits/chosen': -0.6736645698547363, 'epoch': 0.05}
23

  2%|▏         | 24/1464 [08:26<8:22:20, 20.93s/it]
{'loss': 0.7031, 'learning_rate': 1.0909090909090908e-06, 'rewards/chosen': -0.025079822167754173, 'rewards/rejected': 0.00429458636790514, 'rewards/accuracies': 0.4375, 'rewards/margins': -0.029374409466981888, 'policy_logps/rejected': -426.119140625, 'policy_logps/chosen': -490.334716796875, 'referece_logps/rejected': -426.16204833984375, 'referece_logps/chosen': -490.0839538574219, 'logits/rejected': -0.09320729970932007, 'logits/chosen': -0.2287418246269226, 'epoch': 0.05}
24

  2%|▏         | 25/1464 [08:47<8:22:38, 20.96s/it]
{'loss': 0.6876, 'learning_rate': 1.1363636363636364e-06, 'rewards/chosen': -0.016815805807709694, 'rewards/rejected': -0.016275789588689804, 'rewards/accuracies': 0.625, 'rewards/margins': -0.0005400185473263264, 'policy_logps/rejected': -363.3640441894531, 'policy_logps/chosen': -340.7650451660156, 'referece_logps/rejected': -363.2012939453125, 'referece_logps/chosen': -340.5968933105469, 'logits/rejected': -0.12993159890174866, 'logits/chosen': -0.1971982717514038, 'epoch': 0.05}
25

  2%|▏         | 26/1464 [09:08<8:19:47, 20.85s/it]
{'loss': 0.6949, 'learning_rate': 1.1818181818181818e-06, 'rewards/chosen': 0.0023806572426110506, 'rewards/rejected': -0.009962844662368298, 'rewards/accuracies': 0.75, 'rewards/margins': 0.012343503534793854, 'policy_logps/rejected': -401.72039794921875, 'policy_logps/chosen': -481.5340576171875, 'referece_logps/rejected': -401.6207275390625, 'referece_logps/chosen': -481.557861328125, 'logits/rejected': -0.6165238618850708, 'logits/chosen': -0.6156749129295349, 'epoch': 0.05}
26

  2%|▏         | 27/1464 [09:29<8:20:41, 20.91s/it]
{'loss': 0.6975, 'learning_rate': 1.2272727272727272e-06, 'rewards/chosen': -0.02550792507827282, 'rewards/rejected': -0.011589622125029564, 'rewards/accuracies': 0.3125, 'rewards/margins': -0.013918304815888405, 'policy_logps/rejected': -450.6042785644531, 'policy_logps/chosen': -355.5442199707031, 'referece_logps/rejected': -450.4883728027344, 'referece_logps/chosen': -355.28912353515625, 'logits/rejected': -0.7292352318763733, 'logits/chosen': -0.700502336025238, 'epoch': 0.06}
27

  2%|▏         | 28/1464 [09:50<8:22:03, 20.98s/it]
{'loss': 0.6919, 'learning_rate': 1.2727272727272726e-06, 'rewards/chosen': -0.019700240343809128, 'rewards/rejected': 0.01580638624727726, 'rewards/accuracies': 0.25, 'rewards/margins': -0.035506632179021835, 'policy_logps/rejected': -438.56195068359375, 'policy_logps/chosen': -360.5880126953125, 'referece_logps/rejected': -438.72003173828125, 'referece_logps/chosen': -360.3909912109375, 'logits/rejected': -0.7319453954696655, 'logits/chosen': -0.7383365035057068, 'epoch': 0.06}
28

  2%|▏         | 29/1464 [10:11<8:21:27, 20.97s/it]
{'loss': 0.6938, 'learning_rate': 1.318181818181818e-06, 'rewards/chosen': -0.015387248247861862, 'rewards/rejected': 0.014990425668656826, 'rewards/accuracies': 0.25, 'rewards/margins': -0.030377672985196114, 'policy_logps/rejected': -431.73028564453125, 'policy_logps/chosen': -360.6629333496094, 'referece_logps/rejected': -431.8802185058594, 'referece_logps/chosen': -360.50909423828125, 'logits/rejected': -0.05822925269603729, 'logits/chosen': -0.06242978572845459, 'epoch': 0.06}
29

  2%|▏         | 30/1464 [10:32<8:21:02, 20.96s/it]
{'loss': 0.6983, 'learning_rate': 1.3636363636363634e-06, 'rewards/chosen': 0.004251194652169943, 'rewards/rejected': 0.0030439370311796665, 'rewards/accuracies': 0.4375, 'rewards/margins': 0.001207258552312851, 'policy_logps/rejected': -358.14605712890625, 'policy_logps/chosen': -383.88787841796875, 'referece_logps/rejected': -358.176513671875, 'referece_logps/chosen': -383.9303283691406, 'logits/rejected': -0.45291632413864136, 'logits/chosen': -0.49626868963241577, 'epoch': 0.06}
30

  2%|▏         | 31/1464 [10:53<8:21:17, 20.99s/it]
{'loss': 0.6937, 'learning_rate': 1.409090909090909e-06, 'rewards/chosen': -0.0016953463200479746, 'rewards/rejected': -0.0018416410312056541, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.00014629587531089783, 'policy_logps/rejected': -362.8726806640625, 'policy_logps/chosen': -425.84112548828125, 'referece_logps/rejected': -362.854248046875, 'referece_logps/chosen': -425.82415771484375, 'logits/rejected': -0.37712836265563965, 'logits/chosen': -0.3316504955291748, 'epoch': 0.06}
31

  2%|▏         | 32/1464 [11:14<8:21:49, 21.03s/it]
{'loss': 0.6968, 'learning_rate': 1.4545454545454544e-06, 'rewards/chosen': -0.0015842919237911701, 'rewards/rejected': -0.012599753215909004, 'rewards/accuracies': 0.4375, 'rewards/margins': 0.011015462689101696, 'policy_logps/rejected': -470.5435791015625, 'policy_logps/chosen': -354.4413146972656, 'referece_logps/rejected': -470.41754150390625, 'referece_logps/chosen': -354.42547607421875, 'logits/rejected': -0.298993855714798, 'logits/chosen': -0.16398490965366364, 'epoch': 0.07}
32

  2%|▏         | 33/1464 [11:35<8:20:23, 20.98s/it]
{'loss': 0.6986, 'learning_rate': 1.5e-06, 'rewards/chosen': 0.00964736845344305, 'rewards/rejected': 0.05436764284968376, 'rewards/accuracies': 0.3125, 'rewards/margins': -0.04472026973962784, 'policy_logps/rejected': -437.355224609375, 'policy_logps/chosen': -380.6648254394531, 'referece_logps/rejected': -437.89892578125, 'referece_logps/chosen': -380.76129150390625, 'logits/rejected': -0.27856743335723877, 'logits/chosen': -0.28358739614486694, 'epoch': 0.07}
33

  2%|▏         | 34/1464 [11:56<8:17:22, 20.87s/it]
{'loss': 0.6866, 'learning_rate': 1.5454545454545454e-06, 'rewards/chosen': 0.017818737775087357, 'rewards/rejected': 0.0088837631046772, 'rewards/accuracies': 0.625, 'rewards/margins': 0.00893497560173273, 'policy_logps/rejected': -416.2904968261719, 'policy_logps/chosen': -445.6727600097656, 'referece_logps/rejected': -416.37933349609375, 'referece_logps/chosen': -445.8509216308594, 'logits/rejected': -0.48347508907318115, 'logits/chosen': -0.5618680119514465, 'epoch': 0.07}
34

  2%|▏         | 35/1464 [12:17<8:18:31, 20.93s/it]
{'loss': 0.6952, 'learning_rate': 1.5909090909090908e-06, 'rewards/chosen': 0.013734531588852406, 'rewards/rejected': -0.005261803977191448, 'rewards/accuracies': 0.5, 'rewards/margins': 0.018996335566043854, 'policy_logps/rejected': -491.35076904296875, 'policy_logps/chosen': -452.82354736328125, 'referece_logps/rejected': -491.29815673828125, 'referece_logps/chosen': -452.9609375, 'logits/rejected': -0.3033367395401001, 'logits/chosen': -0.26535889506340027, 'epoch': 0.07}
35

  2%|▏         | 36/1464 [12:38<8:18:42, 20.95s/it]
{'loss': 0.6922, 'learning_rate': 1.6363636363636365e-06, 'rewards/chosen': 0.013897418044507504, 'rewards/rejected': -0.0029885289259254932, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.016885949298739433, 'policy_logps/rejected': -385.9876403808594, 'policy_logps/chosen': -354.1466979980469, 'referece_logps/rejected': -385.957763671875, 'referece_logps/chosen': -354.28564453125, 'logits/rejected': -0.6820102334022522, 'logits/chosen': -0.5257217288017273, 'epoch': 0.07}
36

  3%|▎         | 37/1464 [12:59<8:19:26, 21.00s/it]
{'loss': 0.6908, 'learning_rate': 1.6818181818181819e-06, 'rewards/chosen': 0.02007007971405983, 'rewards/rejected': -0.003382490947842598, 'rewards/accuracies': 0.5, 'rewards/margins': 0.02345256879925728, 'policy_logps/rejected': -448.548095703125, 'policy_logps/chosen': -440.2752685546875, 'referece_logps/rejected': -448.5142822265625, 'referece_logps/chosen': -440.4759826660156, 'logits/rejected': -0.4308425784111023, 'logits/chosen': -0.5299962759017944, 'epoch': 0.08}
37

  3%|▎         | 38/1464 [13:20<8:18:19, 20.97s/it]
{'loss': 0.6989, 'learning_rate': 1.7272727272727273e-06, 'rewards/chosen': 0.0018406393937766552, 'rewards/rejected': -0.001905155135318637, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.0037457947619259357, 'policy_logps/rejected': -394.6588439941406, 'policy_logps/chosen': -363.7646789550781, 'referece_logps/rejected': -394.6398010253906, 'referece_logps/chosen': -363.7830810546875, 'logits/rejected': -0.7417290210723877, 'logits/chosen': -0.7663588523864746, 'epoch': 0.08}
38

  3%|▎         | 39/1464 [13:41<8:19:16, 21.02s/it]
{'loss': 0.6912, 'learning_rate': 1.7727272727272727e-06, 'rewards/chosen': -0.001994227757677436, 'rewards/rejected': -0.012085439637303352, 'rewards/accuracies': 0.4375, 'rewards/margins': 0.010091209784150124, 'policy_logps/rejected': -408.88043212890625, 'policy_logps/chosen': -421.82928466796875, 'referece_logps/rejected': -408.75958251953125, 'referece_logps/chosen': -421.80926513671875, 'logits/rejected': -0.2968500554561615, 'logits/chosen': -0.40646031498908997, 'epoch': 0.08}
39

  3%|▎         | 40/1464 [14:02<8:18:35, 21.01s/it]
{'loss': 0.6964, 'learning_rate': 1.818181818181818e-06, 'rewards/chosen': 0.002830219455063343, 'rewards/rejected': -0.0007460116175934672, 'rewards/accuracies': 0.5, 'rewards/margins': 0.0035762309562414885, 'policy_logps/rejected': -431.5315246582031, 'policy_logps/chosen': -385.87261962890625, 'referece_logps/rejected': -431.5240783691406, 'referece_logps/chosen': -385.90093994140625, 'logits/rejected': -0.8243836760520935, 'logits/chosen': -0.9314780235290527, 'epoch': 0.08}
40
40
{'loss': 0.6831, 'learning_rate': 1.8636363636363635e-06, 'rewards/chosen': 0.021337127313017845, 'rewards/rejected': 0.00496521033346653, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.016371916979551315, 'policy_logps/rejected': -411.123046875, 'policy_logps/chosen': -364.40802001953125, 'referece_logps/rejected': -411.17266845703125, 'referece_logps/chosen': -364.62139892578125, 'logits/rejected': -0.12697423994541168, 'logits/chosen': -0.19777268171310425, 'epoch': 0.08}

  3%|▎         | 41/1464 [14:23<8:18:48, 21.03s/it]

  3%|▎         | 42/1464 [14:44<8:18:38, 21.04s/it]
{'loss': 0.6952, 'learning_rate': 1.909090909090909e-06, 'rewards/chosen': -0.0044134631752967834, 'rewards/rejected': 0.0027428630273789167, 'rewards/accuracies': 0.4375, 'rewards/margins': -0.007156324572861195, 'policy_logps/rejected': -426.09075927734375, 'policy_logps/chosen': -406.1163024902344, 'referece_logps/rejected': -426.1181640625, 'referece_logps/chosen': -406.0721435546875, 'logits/rejected': 0.3171212375164032, 'logits/chosen': 0.2252608686685562, 'epoch': 0.09}
42

  3%|▎         | 43/1464 [15:05<8:17:51, 21.02s/it]
{'loss': 0.6904, 'learning_rate': 1.9545454545454545e-06, 'rewards/chosen': 0.003293323563411832, 'rewards/rejected': -0.018165968358516693, 'rewards/accuracies': 0.625, 'rewards/margins': 0.021459292620420456, 'policy_logps/rejected': -328.17169189453125, 'policy_logps/chosen': -379.4380798339844, 'referece_logps/rejected': -327.9900207519531, 'referece_logps/chosen': -379.4710388183594, 'logits/rejected': -0.38139116764068604, 'logits/chosen': -0.3893568813800812, 'epoch': 0.09}
43

  3%|▎         | 44/1464 [15:24<8:06:26, 20.55s/it]
{'loss': 0.6909, 'learning_rate': 2e-06, 'rewards/chosen': 0.007222033105790615, 'rewards/rejected': 9.527197107672691e-05, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.0071267616003751755, 'policy_logps/rejected': -399.3399658203125, 'policy_logps/chosen': -386.64678955078125, 'referece_logps/rejected': -399.3409118652344, 'referece_logps/chosen': -386.7190856933594, 'logits/rejected': -0.424583375453949, 'logits/chosen': -0.41207730770111084, 'epoch': 0.09}
44

  3%|▎         | 45/1464 [15:45<8:09:38, 20.70s/it]
{'loss': 0.6873, 'learning_rate': 1.999997552668028e-06, 'rewards/chosen': 0.03537702560424805, 'rewards/rejected': 0.007114696782082319, 'rewards/accuracies': 0.5, 'rewards/margins': 0.02826232649385929, 'policy_logps/rejected': -436.93304443359375, 'policy_logps/chosen': -369.9384460449219, 'referece_logps/rejected': -437.0042724609375, 'referece_logps/chosen': -370.2922058105469, 'logits/rejected': -0.9703054428100586, 'logits/chosen': -1.153047800064087, 'epoch': 0.09}
45

  3%|▎         | 46/1464 [16:06<8:09:10, 20.70s/it]
{'loss': 0.6885, 'learning_rate': 1.999990210684092e-06, 'rewards/chosen': 0.006806183606386185, 'rewards/rejected': -0.017774391919374466, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.0245805736631155, 'policy_logps/rejected': -328.75567626953125, 'policy_logps/chosen': -373.9969482421875, 'referece_logps/rejected': -328.57794189453125, 'referece_logps/chosen': -374.06500244140625, 'logits/rejected': -0.41376882791519165, 'logits/chosen': -0.46290522813796997, 'epoch': 0.09}
46

  3%|▎         | 47/1464 [16:27<8:08:21, 20.68s/it]
{'loss': 0.6989, 'learning_rate': 1.999977974084128e-06, 'rewards/chosen': -0.02037983015179634, 'rewards/rejected': -0.005970573518425226, 'rewards/accuracies': 0.375, 'rewards/margins': -0.014409255236387253, 'policy_logps/rejected': -541.5065307617188, 'policy_logps/chosen': -377.66998291015625, 'referece_logps/rejected': -541.4468383789062, 'referece_logps/chosen': -377.4661865234375, 'logits/rejected': -1.0863926410675049, 'logits/chosen': -1.1428035497665405, 'epoch': 0.1}
47

  3%|▎         | 48/1464 [16:48<8:10:31, 20.78s/it]
{'loss': 0.6906, 'learning_rate': 1.99996084292803e-06, 'rewards/chosen': 0.019129134714603424, 'rewards/rejected': 0.011342143639922142, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.007786988280713558, 'policy_logps/rejected': -290.77105712890625, 'policy_logps/chosen': -373.4788818359375, 'referece_logps/rejected': -290.8844909667969, 'referece_logps/chosen': -373.670166015625, 'logits/rejected': -0.4451132118701935, 'logits/chosen': -0.4566010534763336, 'epoch': 0.1}
48

  3%|▎         | 49/1464 [17:09<8:12:18, 20.88s/it]
{'loss': 0.6934, 'learning_rate': 1.9999388172996495e-06, 'rewards/chosen': -0.015194321051239967, 'rewards/rejected': -0.01943383179605007, 'rewards/accuracies': 0.4375, 'rewards/margins': 0.004239510744810104, 'policy_logps/rejected': -368.3424987792969, 'policy_logps/chosen': -336.1029968261719, 'referece_logps/rejected': -368.1481628417969, 'referece_logps/chosen': -335.9510498046875, 'logits/rejected': -0.5374951362609863, 'logits/chosen': -0.5141730308532715, 'epoch': 0.1}
49

  3%|▎         | 50/1464 [17:30<8:12:43, 20.91s/it]
{'loss': 0.6913, 'learning_rate': 1.999911897306794e-06, 'rewards/chosen': 0.005071735940873623, 'rewards/rejected': -0.008144760504364967, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.013216497376561165, 'policy_logps/rejected': -393.365234375, 'policy_logps/chosen': -430.64776611328125, 'referece_logps/rejected': -393.2837829589844, 'referece_logps/chosen': -430.69842529296875, 'logits/rejected': -0.005854379385709763, 'logits/chosen': -0.13085994124412537, 'epoch': 0.1}
50

  3%|▎         | 51/1464 [17:51<8:12:04, 20.89s/it]
{'loss': 0.6917, 'learning_rate': 1.9998800830812287e-06, 'rewards/chosen': -0.010067939758300781, 'rewards/rejected': -0.007901095785200596, 'rewards/accuracies': 0.5, 'rewards/margins': -0.0021668411791324615, 'policy_logps/rejected': -402.79937744140625, 'policy_logps/chosen': -380.1234436035156, 'referece_logps/rejected': -402.7203369140625, 'referece_logps/chosen': -380.02276611328125, 'logits/rejected': -0.8042851090431213, 'logits/chosen': -0.578301727771759, 'epoch': 0.1}
51
51
{'loss': 0.6854, 'learning_rate': 1.9998433747786726e-06, 'rewards/chosen': 0.010393046773970127, 'rewards/rejected': 0.02358694188296795, 'rewards/accuracies': 0.4375, 'rewards/margins': -0.013193895108997822, 'policy_logps/rejected': -441.6932373046875, 'policy_logps/chosen': -432.8459167480469, 'referece_logps/rejected': -441.92913818359375, 'referece_logps/chosen': -432.9498291015625, 'logits/rejected': -0.09380701184272766, 'logits/chosen': -0.17370906472206116, 'epoch': 0.11}

  4%|▎         | 52/1464 [18:11<8:09:08, 20.79s/it]

  4%|▎         | 53/1464 [18:32<8:09:32, 20.82s/it]
{'loss': 0.6901, 'learning_rate': 1.999801772578801e-06, 'rewards/chosen': 0.017998408526182175, 'rewards/rejected': 0.007908441126346588, 'rewards/accuracies': 0.5625, 'rewards/margins': 0.010089971125125885, 'policy_logps/rejected': -432.25146484375, 'policy_logps/chosen': -402.03460693359375, 'referece_logps/rejected': -432.33050537109375, 'referece_logps/chosen': -402.2145690917969, 'logits/rejected': -0.5111173391342163, 'logits/chosen': -0.5980086326599121, 'epoch': 0.11}
53

  4%|▎         | 54/1464 [18:53<8:08:25, 20.78s/it]
{'loss': 0.6894, 'learning_rate': 1.999755276685243e-06, 'rewards/chosen': 0.003053140826523304, 'rewards/rejected': 0.005502558313310146, 'rewards/accuracies': 0.3125, 'rewards/margins': -0.0024494167882949114, 'policy_logps/rejected': -375.41326904296875, 'policy_logps/chosen': -434.24566650390625, 'referece_logps/rejected': -375.46832275390625, 'referece_logps/chosen': -434.27618408203125, 'logits/rejected': -0.9899569749832153, 'logits/chosen': -0.9743199944496155, 'epoch': 0.11}
54

  4%|▍         | 55/1464 [19:14<8:09:26, 20.84s/it]
{'loss': 0.6893, 'learning_rate': 1.99970388732558e-06, 'rewards/chosen': 0.005156135186553001, 'rewards/rejected': 0.02081766165792942, 'rewards/accuracies': 0.25, 'rewards/margins': -0.01566152460873127, 'policy_logps/rejected': -392.06243896484375, 'policy_logps/chosen': -434.26910400390625, 'referece_logps/rejected': -392.27056884765625, 'referece_logps/chosen': -434.3207092285156, 'logits/rejected': -0.626272976398468, 'logits/chosen': -0.7484424114227295, 'epoch': 0.11}
55
batch_input_ids: 32
image size:torch.Size([32, 3, 336, 336])
  4%|▍         | 55/1464 [19:14<8:09:26, 20.84s/it]Traceback (most recent call last):
  File "/mnt/petrelfs/songmingyang/code/mm/MAPO/m3apo/alignment/models/llava_v1_5/./train_dpo.py", line 861, in <module>
    main()
  File "/mnt/petrelfs/songmingyang/code/mm/MAPO/m3apo/alignment/models/llava_v1_5/./train_dpo.py", line 858, in main
    dpo_trainer.train()
  File "/mnt/petrelfs/songmingyang/anaconda3/envs/vcd/lib/python3.9/site-packages/transformers/trainer.py", line 1539, in train
    return inner_training_loop(
  File "/mnt/petrelfs/songmingyang/anaconda3/envs/vcd/lib/python3.9/site-packages/transformers/trainer.py", line 1809, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs)
  File "/mnt/petrelfs/songmingyang/anaconda3/envs/vcd/lib/python3.9/site-packages/transformers/trainer.py", line 2654, in training_step
    loss = self.compute_loss(model, inputs)
  File "/mnt/petrelfs/songmingyang/code/mm/MAPO/m3apo/alignment/trainer/llava_dpo_trainer.py", line 150, in compute_loss
    loss, metrics = self.get_batch_metrics(inputs, train_eval="train")
  File "/mnt/petrelfs/songmingyang/code/mm/MAPO/m3apo/alignment/trainer/llava_dpo_trainer.py", line 103, in get_batch_metrics
    ) = self.concatenated_forward(self.model, inputs)
  File "/mnt/petrelfs/songmingyang/code/mm/MAPO/m3apo/alignment/trainer/llava_dpo_trainer.py", line 43, in concatenated_forward
    remote_breakpoint()
  File "/mnt/petrelfs/songmingyang/code/mm/MAPO/m3apo/utils/debugging.py", line 57, in remote_breakpoint
    _dp()
  File "/mnt/petrelfs/songmingyang/code/mm/MAPO/m3apo/utils/debugging.py", line 51, in _dp
    debugpy.listen((host, port))
  File "/mnt/petrelfs/songmingyang/anaconda3/envs/vcd/lib/python3.9/site-packages/debugpy/public_api.py", line 31, in wrapper
    return wrapped(*args, **kwargs)
  File "/mnt/petrelfs/songmingyang/anaconda3/envs/vcd/lib/python3.9/site-packages/debugpy/server/api.py", line 143, in debug
    log.reraise_exception("{0}() failed:", func.__name__, level="info")
  File "/mnt/petrelfs/songmingyang/anaconda3/envs/vcd/lib/python3.9/site-packages/debugpy/server/api.py", line 141, in debug
    return func(address, settrace_kwargs, **kwargs)
  File "/mnt/petrelfs/songmingyang/anaconda3/envs/vcd/lib/python3.9/site-packages/debugpy/server/api.py", line 262, in listen
    raise RuntimeError(str(endpoints["error"]))
RuntimeError: Can't listen for client connections: [Errno 98] Address already in use